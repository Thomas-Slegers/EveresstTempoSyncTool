{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "AWS CloudFormation Template for Beanstalk Application with specific requirements",
  "Resources": {
    "EveresstTempoSyncToolApplication": {
      "Type": "AWS::ElasticBeanstalk::Application",
      "Properties": {
        "Description": "Elastic Beanstalk Application",
        "ApplicationName": "EveresstTempoSyncTool"
      }
    },
    "EveresstTempoSyncToolEnvironment": {
      "Type": "AWS::ElasticBeanstalk::Environment",
      "Properties": {
        "ApplicationName": {
          "Ref": "EveresstTempoSyncToolApplication"
        },
        "EnvironmentName": "EveresstTempoSyncToolEnvironment",
        "SolutionStackName": "64bit Amazon Linux 2023 v4.0.1 running Corretto 17",
        "OptionSettings": [
          {
            "Namespace": "aws:autoscaling:launchconfiguration",
            "OptionName": "InstanceType",
            "Value": "t4g.micro"
          },
          {
            "Namespace": "aws:autoscaling:launchconfiguration",
            "OptionName": "EC2KeyName",
            "Value": "CloudFormationKeyPair"
          },
          {
            "Namespace": "aws:autoscaling:launchconfiguration",
            "OptionName": "IamInstanceProfile",
            "Value": {
              "Ref": "BeanstalkInstanceProfile"
            }
          },
          {
            "Namespace": "aws:autoscaling:asg",
            "OptionName": "MaxSize",
            "Value": "1"
          },
          {
            "Namespace": "aws:elasticbeanstalk:environment",
            "OptionName": "EnvironmentType",
            "Value": "SingleInstance"
          }
          ]
        }
        },
          "BeanstalkRole": {
            "Type": "AWS::IAM::Role",
            "Properties": {
              "AssumeRolePolicyDocument": {
                "Version": "2012-10-17",
                "Statement": [
                  {
                    "Effect": "Allow",
                    "Principal": {
                      "Service": ["ec2.amazonaws.com"]
                    },
                    "Action": ["sts:AssumeRole"]
                  }
                ]
              },
              "Path": "/",
              "Policies": [
                {
                  "PolicyName": "root",
                  "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                      {
                        "Effect": "Allow",
                        "Action": [
                          "cloudwatch:*",
                          "ec2:*",
                          "elasticbeanstalk:*",
                          "elasticloadbalancing:*",
                          "s3:*",
                          "sns:*"
                        ],
                        "Resource": "*"
                      }
                    ]
                  }
                }
              ]
            }
          },
          "BeanstalkInstanceProfile": {
            "Type": "AWS::IAM::InstanceProfile",
            "Properties": {
              "Path": "/",
              "Roles": [
                {
                  "Ref": "BeanstalkRole"
                }
                ]
              }
              },
                "SecurityGroup": {
                  "Type": "AWS::EC2::SecurityGroup",
                  "Properties": {
                    "GroupDescription": "Security group for Elastic Beanstalk environment",
                    "VpcId": "YOUR_VPC_ID",
                    "SecurityGroupIngress": [
                      {
                        "IpProtocol": "tcp",
                        "FromPort": 80,
                        "ToPort": 80,
                        "CidrIp": "0.0.0.0/0"
                      }
                    ]
                  }
                },
                "BeanstalkEnvironmentSecurityGroup": {
                  "Type": "AWS::ElasticBeanstalk::Environment",
                  "Properties": {
                    "ApplicationName": {
                      "Ref": "EveresstTempoSyncToolApplication"
                    },
                    "EnvironmentName": "EveresstTempoSyncToolEnvironment",
                    "SolutionStackName": "64bit Amazon Linux 2023 v4.0.1 running Corretto 17",
                    "OptionSettings": [
                      {
                        "Namespace": "aws:autoscaling:launchconfiguration",
                        "OptionName": "SecurityGroups",
                        "Value": { "Fn::GetAtt": ["SecurityGroup", "GroupId"] }
                      },
                      {
                        "Namespace": "aws:elasticbeanstalk:environment",
                        "OptionName": "EnvironmentType",
                        "Value": "SingleInstance"
                      }
                    ]
                  }
                }
                }
              }
